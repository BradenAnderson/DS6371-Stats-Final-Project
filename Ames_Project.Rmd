---
title: "Ames_Project"
author: "Braden Anderson and Rayon Morris"
date: "12/2/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

source("./Functions.R")
```


```{r}
df <- read.csv("./train.csv")
head(full_df)

```


```{r}

# Filter dataframe such that it only includes rows where the neighborhood column
# is one of the neighborhoods we are interested in for the part 1 analysis.

# Neighborhoods that Century 21 Ames real estate sells in
interesting_neighborhoods <- c("NAmes", "Edwards", "BrkSide")

# Create a new dataframe that only contains the neighborhoods Centry 21 Ames sells in
century_df <- df[(df[,"Neighborhood"] %in% interesting_neighborhoods), ]

# Verify the new dataframe only contains the neighborhoods: NAmes, Edwards, and BrkSide
unique(century_df[,"Neighborhood"])

```


# Check Model Assumptions

# Linearity Assumption
```{r}

interesting_neighborhoods <- c("NAmes", "Edwards", "BrkSide")

# Basic scatter plot of SalePrice vs GrLivArea
# Neighborhood column filtered to three neighborhoods of interest.
# Points colored based on neighborhood column, 
# Regression line added
plot_scatter(data=century_df, 
             y_var="SalePrice", 
             x_var="GrLivArea", 
             shade_var = "Neighborhood", 
             show_regression=FALSE, 
             reg_table=FALSE,
             identify_obs = c(131, 339)) # Set to TRUE to ID all observations, or a vector for paricular obs
                                         

# Overall the scatter plot shows strong evidence of a linear trend, however there are a couple concerning (outlier) 
# observations (which we have flagged as observation numbers 131 and 339) that should be investigated. 

# Note that these observation numbers correspond to the rows in the century_df dataframe which has been filtered to 
# only contain observations in the three neighborhoods of interest. (Therefore these observation numbers will be different 
# in the full dataset). 

# Also note that these concerning observations are both in the Edwards neighborhood, and are both large 
# homes that had a unusually low sale price. 
```



```{r}

# 1) Equal Lines Model <-- Single regression line for all neighborhoods 

# Does the relationship between sales and living area depend on the neighborhood?
# If yes:
# 2) Parallel lines model <-- The neighborhood effects it at constant ammount across all values of the response
# 3) Separate lines model <-- The neighborhood effects the slope

```


# Model 1: Equal Lines Model
```{r}

fit <- lm(SalePrice~GrLivArea, 
          data=century_df)

summary(fit)
```


```{r, fig.height=4, fig.width=8}

plot_residuals(fit, 
               residual_type="regular", 
               plot_zero_hline=TRUE, 
               extreme_thresh_regular=5, 
               flag_extreme_values=TRUE, 
               id_extreme_values=TRUE)

# The majority of the residual plot is a reasonable representation of the ideal "random cloud", indicating
# that the linearity assumption is met for the majority of the data. However as mentioned with the scatterplot,
# we see a couple outlieing observations that violate this assumption. 
```

# Indepdence Assumption
```{r}

# From the residual plot above, do not see any "tracking" in the residuals. Based on how the data was collected
# we do not have a reason to suspect that serial or cluster effects exist. The Independence assumption is always
# difficult to be completely confident in without intimate knowledge of the data collection process, however
# we will proceed with caution as if this assumption is met.

```


# Normality Assumption
```{r}

plot_residual_qq(fit=fit, 
                 residual_type = "regular")


# Based on the QQPlot of the residuals shown below, we see that overall the quantiles of the residuals are
# linearly related to the theoretical quantiles of the normal distribution. That said, we again note that there are still
# the same few observations raising concern as they do not meet the normality assumption. 
# In particular observation 339 is causing some skew that violates the normality assumption. 
```


```{r}

plot_residual_histogram(fit=fit, 
                        residual_type="regular", 
                        overlay_normal = TRUE, 
                        num_bins=75,
                        normal_linecolor="purple")

# The residual histogram confirms what we see in the residual QQplot. This plot offers another perspective
# but tells the same story; that are a few observations causing some significant skew which violates 
# the normality of errors assumption.
```

```{r}

plot_residuals(fit, 
               residual_type="externally_studentized", 
               plot_zero_hline=TRUE, 
               extreme_thresh_regular=5, 
               flag_extreme_values=TRUE, 
               id_extreme_values=TRUE)

# Lastly, we review the plot of externally studentized residuals in the context of the normality assumption.
# We see that, for the most part, the residuals seem to be normally distributed around zero, and are not
# consistently shifted in either the positive or negative direction which would be indicative of a 
# heavily skewed distribution. This plot does help identify some potential outliers that may not fit the
# normality assumption. In particular, we note that observations 131, 169, 190 and 339 are all more
# than three standard deviations away from zero and therefore may warrant further inspection.
```

# Equal Variance Assumption
```{r}

plot_residuals(fit, 
               residual_type="regular", 
               plot_zero_hline=TRUE, 
               extreme_thresh_regular=5, 
               flag_extreme_values=TRUE, 
               id_extreme_values=TRUE)

# Reviewing the residual plot in the context of the equal variance assumption, we do not see any
# "fanning" or "funnel shaped" pattern in the plot which would clearly indicate of a violation of
# this assumption. Further, the spread of the residuals about zero seems reasonably consistent across
# the range of fitted values for most observations, again with the exception of observations 131 and 339.
# Observations 131 and 339 have rather large residuals, and considering that there are no other
# observations even close to these fitted values it would be rather unusual to observe such large
# residuals in 2 out of 2 samples if they truly were drawn from a population with the same variance
# as the other observations. 

```

# Model 2: Parallel Lines Model
```{r}

century_df[,"Neighborhood"] <- factor(century_df[,"Neighborhood"])

# Parallel lines model
parallel_fit <- lm(SalePrice~GrLivArea+
                     relevel(Neighborhood, ref="NAmes"), # Add indicator variables (intercept adjustment terms).
                   data=century_df)

summary(parallel_fit)
```


#Model 3: Separate Lines Model
```{r}

separate_fits <- lm(SalePrice~GrLivArea+
                      relevel(Neighborhood, ref="NAmes")+             # Add intercept adjustment terms
                      relevel(Neighborhood, ref="NAmes"):GrLivArea,   # Add interaction terms (slope adjustments)
                    data=century_df)

summary(separate_fits)
```


```{r}


```


```{r}


```


```{r}


```


```{r}


```


```{r}


```


```{r}


```